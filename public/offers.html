<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pet Offers â€” PetRewardHub</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
</head>
<body class="bg-gradient-to-br from-[#eff6ff] to-[#fef9c3] font-[Inter] min-h-screen">
<header class="sticky top-0 z-50 bg-white/80 backdrop-blur border-b">
  <div class="max-w-5xl mx-auto px-6 py-3 flex items-center justify-between">
    <div class="font-extrabold">ğŸ¾ PetRewardHub</div>
    <div class="flex items-center gap-3 text-sm">
      <span class="inline-flex items-center gap-1 rounded-full bg-yellow-200 px-3 h-8 font-bold">ğŸ’° <span id="coinBadge">0</span> Coins</span>
      <span id="userEmail" class="text-gray-700">Signed in as ...</span>
      <button id="logoutBtn" class="ml-1 h-9 px-4 rounded-full border">Logout</button>
    </div>
  </div>
</header>

<main class="max-w-5xl mx-auto px-6 py-8">
  <h2 class="text-2xl font-bold">ğŸ Pet Offers For You</h2>
  <p class="text-gray-600">Complete these offers and earn coins to claim free gifts.</p>
  <div id="offerContainer" class="grid grid-cols-[repeat(auto-fill,minmax(260px,1fr))] gap-5 mt-6">
    <p>Loading offers...</p>
  </div>
</main>

<footer class="text-center text-sm text-gray-500 py-10">Â© 2025 PetRewardHub Â· Safe & Trusted</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="firebase-init.js"></script>
<script src="app.js"></script>

<!-- jQuery for JSONP -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script>
const emailEl = document.getElementById("userEmail");
const coinEl  = document.getElementById("coinBadge");
const logoutBtn = document.getElementById("logoutBtn");

// Attach realtime coin listener
attachCoinListener(emailEl, coinEl, logoutBtn);

// Load AdBlue offers with JSONP (NEW endpoint)
firebase.auth().onAuthStateChanged(user=>{
  if(!user) return; // attachCoinListener will redirect
  $("#offerContainer").html("<p>â³ Loading latest offers...</p>");
  $.getJSON(
    "https://d2xohqmdyl2cj3.cloudfront.net/public/offers/feed.php?user_id=481160&api_key=89a09f95e53dde3a5e593491e1134540&s1="+user.uid+"&callback=?",
    function(offers){
      let html=""; const num=8; offers=offers.splice(0,num);
      $.each(offers, function(_, offer){
        const title = offer.name || offer.anchor || "Offer";
        const desc  = offer.description || "Complete this offer and earn rewards!";
        const url   = (offer.url || offer.tracking_url) + "&sub1=" + user.uid;

        // Display-only coin tag (coins are credited ONLY by postback)
        let coins = 10;
        const t = (title+" "+desc).toLowerCase();
        if(t.includes("email")||t.includes("submit")||t.includes("signup")||t.includes("register")||t.includes("survey")||t.includes("trial")||t.includes("cpe")) coins=20;
        else if(t.includes("install")||t.includes("app")) coins=10;

        html += `
          <div class="bg-white rounded-2xl shadow p-5 hover:shadow-xl transition">
            <span class="inline-block mb-2 text-xs font-bold px-3 py-1 rounded-full bg-gradient-to-r from-blue-500 to-yellow-300">ğŸ’° Earn ${coins} Coins</span>
            <h4 class="font-semibold">${title}</h4>
            <p class="text-sm text-gray-600 mt-1">${desc}</p>
            <a href="${url}" target="_blank" class="mt-4 inline-block rounded-full h-10 px-5 bg-blue-600 text-white font-semibold">Open Offer</a>
          </div>`;
      });
      $("#offerContainer").html(html || "<p>âš ï¸ No offers available right now.</p>");
    }
  ).fail(()=> $("#offerContainer").html("<p>âš ï¸ Could not load offers. Please refresh.</p>"));
});
</script>
</body></html>
