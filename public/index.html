<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetRewardHub - Earn Free Pet Gifts</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="index.html" class="logo">PetRewardHub</a>
                <div class="nav-links">
                    <div id="authButtons" style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="openLoginModal()">Login</button>
                        <a href="signup.html" class="btn btn-secondary">Sign Up</a>
                    </div>
                    <div id="userNav" style="display: none; align-items: center; gap: 1rem;">
                        <a href="offers.html" class="nav-link">Offers</a>
                        <a href="gifts.html" class="nav-link">Gifts</a>
                        <a href="claim.html" class="nav-link">Claim</a>
                        <div class="coin-badge">
                            üí∞ <span id="coinBadge">0</span>
                        </div>
                        <button id="logoutBtn" class="btn btn-secondary">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Earn Free Gifts for Your Pet</h1>
                <p>Complete simple offers, earn coins, and redeem amazing pet gifts! Get 25 coins FREE when you sign up. From toys to treats, we've got everything your furry friend deserves!</p>
                <button class="btn btn-primary" onclick="startUserJourney()">
                    Start Earning Now
                </button>
            </div>
        </div>
    </section>

    <!-- Gifts Preview Section -->
    <section id="gifts-section" class="section">
        <div class="container">
            <h2 class="section-title">Popular Pet Gifts</h2>
            <div class="grid grid-3" id="giftsGrid">
                <!-- Gift cards will be dynamically loaded -->
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="section" style="background: var(--white);">
        <div class="container">
            <h2 class="section-title">How It Works</h2>
            <div class="grid grid-3">
                <div class="card text-center">
                    <div class="card-body">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">1Ô∏è‚É£</div>
                        <h3>Sign Up & Get 25 Coins FREE</h3>
                        <p>Create your free account and get 25 coins instantly as a welcome bonus!</p>
                    </div>
                </div>
                <div class="card text-center">
                    <div class="card-body">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">2Ô∏è‚É£</div>
                        <h3>Earn More Coins</h3>
                        <p>Complete simple offers and surveys to earn 10-20 coins per offer</p>
                    </div>
                </div>
                <div class="card text-center">
                    <div class="card-body">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">3Ô∏è‚É£</div>
                        <h3>Redeem Free Gifts</h3>
                        <p>Use your coins to get free pet gifts delivered to your door</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Gift Detail Modal -->
    <div id="giftModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeGiftModal()">&times;</button>
            <div id="giftModalContent">
                <!-- Modal content will be dynamically loaded -->
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeLoginModal()">&times;</button>
            <h2 style="margin-bottom: 2rem; text-align: center;">Login to Your Account</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail" class="form-label">Email</label>
                    <input type="email" id="loginEmail" class="form-input" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword" class="form-label">Password</label>
                    <input type="password" id="loginPassword" class="form-input" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                    Login
                </button>
            </form>
            <p style="text-align: center;">
                Don't have an account? <a href="signup.html" style="color: var(--primary-blue);">Sign up here</a>
            </p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-init.js"></script>
    <script src="app.js"></script>
    
    <script>
        // Gifts data (same as gifts.html)
        const gifts = [
            {
                id: 'gift-1',
                name: 'Premium Pet Toy',
                description: 'Durable interactive toy that provides hours of entertainment and mental stimulation for your pet. Made with safe, non-toxic materials.',
                image: 'https://images.unsplash.com/photo-1591946614720-90a587da4a36?w=500',
                coins: 100,
                category: 'Toys'
            },
            {
                id: 'gift-2',
                name: 'Gourmet Treats',
                description: 'Healthy, delicious snacks made with natural ingredients that your pet will absolutely love. No artificial preservatives or colors.',
                image: 'https://images.unsplash.com/photo-1576201836106-db1758fd1c97?w=500',
                coins: 150,
                category: 'Food'
            },
            {
                id: 'gift-3',
                name: 'Comfy Pet Bed',
                description: 'Plush orthopedic bed designed for ultimate comfort and support, perfect for napping. Machine washable and durable.',
                image: 'https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=500',
                coins: 200,
                category: 'Bedding'
            },
            {
                id: 'gift-4',
                name: 'Grooming Kit',
                description: 'Complete grooming set including brush, nail clippers, and shampoo for proper pet care. Keep your pet looking their best.',
                image: 'https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=500',
                coins: 120,
                category: 'Care'
            },
            {
                id: 'gift-5',
                name: 'Training Set',
                description: 'Essential tools for pet training including clicker, treats pouch, and training guide. Perfect for teaching new tricks.',
                image: 'https://images.unsplash.com/photo-1558322394-8fc89f4c9b0f?w=500',
                coins: 180,
                category: 'Training'
            }
        ];

        // Initialize index page
        function initIndexPage() {
            renderGifts();
            setupEventListeners();
        }

        // Render gifts on index page
        function renderGifts() {
            const giftsGrid = document.getElementById('giftsGrid');
            let html = '';

            // First 5 gifts
            gifts.forEach(gift => {
                html += `
                    <div class="card gift-card" onclick="openGiftModal('${gift.id}')">
                        <img src="${gift.image}" alt="${gift.name}" class="card-img">
                        <div class="card-body">
                            <h3>${gift.name}</h3>
                            <p class="coin-badge" style="display: inline-flex; margin-bottom: 1rem;">${gift.coins} Coins</p>
                            <p>${gift.description.substring(0, 80)}...</p>
                        </div>
                    </div>
                `;
            });

            // "See All Gifts" card
            html += `
                <a href="gifts.html" class="card" style="text-decoration: none; color: inherit;">
                    <div class="card-body" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                        <h3 style="margin-bottom: 1rem;">See All Gifts</h3>
                        <p style="text-align: center; color: var(--gray-600);">
                            Discover our complete collection of amazing pet gifts and rewards!
                        </p>
                        <button class="btn btn-primary mt-2">View All</button>
                    </div>
                </a>
            `;

            giftsGrid.innerHTML = html;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login form handler
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const submitBtn = e.target.querySelector('button[type="submit"]');
                
                submitBtn.textContent = 'Logging in...';
                submitBtn.disabled = true;
                
                const result = await app.login(email, password);
                
                if (result.success) {
                    closeLoginModal();
                    redirectAfterLogin();
                } else {
                    alert('Login failed: ' + result.error);
                    submitBtn.textContent = 'Login';
                    submitBtn.disabled = false;
                }
            });
        }

        // Open gift modal
        function openGiftModal(giftId) {
            const gift = gifts.find(g => g.id === giftId);
            if (!gift) return;

            const modalContent = document.getElementById('giftModalContent');
            const isLoggedIn = app.currentUser !== null;
            const canClaim = isLoggedIn && app.userData && app.userData.coins >= gift.coins;

            modalContent.innerHTML = `
                <img src="${gift.image}" alt="${gift.name}" class="gift-modal-image">
                <h2>${gift.name}</h2>
                <div class="gift-coins mb-2">${gift.coins} Coins Required</div>
                <p class="gift-description mb-3">${gift.description}</p>
                
                ${isLoggedIn ? `
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn ${canClaim ? 'btn-primary' : 'btn-secondary'}" 
                                style="flex: 1;" 
                                ${!canClaim ? 'disabled' : ''}
                                onclick="claimGift('${gift.id}')">
                            ${canClaim ? 'Claim This Gift' : `Need ${gift.coins - (app.userData?.coins || 0)} More Coins`}
                        </button>
                        <button class="btn btn-secondary" onclick="closeGiftModal()">Close</button>
                    </div>
                    ${!canClaim ? `
                        <div class="message mt-3">
                            <p>üí° Complete more offers on the <a href="offers.html">Offers page</a> to earn coins!</p>
                        </div>
                    ` : ''}
                ` : `
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" style="flex: 1;" onclick="openLoginModal(); closeGiftModal();">
                            Login to Claim
                        </button>
                        <button class="btn btn-secondary" onclick="closeGiftModal()">Close</button>
                    </div>
                    <div class="message mt-3">
                        <p>üí° <a href="javascript:void(0)" onclick="openLoginModal(); closeGiftModal();">Login</a> or <a href="signup.html">sign up</a> to claim this gift and get 25 FREE coins!</p>
                    </div>
                `}
            `;

            document.getElementById('giftModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Close gift modal
        function closeGiftModal() {
            document.getElementById('giftModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Claim gift from index page
        function claimGift(giftId) {
            if (!app.currentUser) {
                openLoginModal();
                return;
            }

            const gift = gifts.find(g => g.id === giftId);
            if (!gift) return;

            if (app.userData.coins >= gift.coins) {
                // Store selected gift in session storage and redirect to claim page
                sessionStorage.setItem('selectedGift', JSON.stringify(gift));
                window.location.href = 'claim.html';
            } else {
                alert(`You need ${gift.coins} coins to claim this gift. You currently have ${app.userData.coins} coins. Complete more offers to earn coins!`);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initIndexPage);
    </script>
</body>
</html>