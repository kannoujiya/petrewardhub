<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PetRewardHub â€” Login or Signup</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- âœ… Firebase SDKs (must load before app.js) -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>

  <!-- âœ… App logic -->
  <script src="app.js" defer></script>
</head>
<body>
  <header class="hero">
    <div class="container">
      <h1>ğŸ¾ PetRewardHub</h1>
      <p class="lead">Earn free pet gadgets by completing offers â€” redeem after 100 coins!</p>
    </div>
  </header>

  <main class="container">
    <div class="card" style="max-width:420px;margin:auto;">
      <h2 class="text-xl font-bold">Sign up / Log in</h2>

      <div class="mt-3">
        <input id="email" placeholder="Email address" type="email" />
        <input id="password" placeholder="Password" type="password" />
      </div>

      <div class="actions" style="margin-top:10px;">
        <button id="signupBtn">Sign Up</button>
        <button id="loginBtn" class="secondary">Log In</button>
      </div>

      <div style="text-align:center;margin-top:10px;">
        <small>or</small>
      </div>

      <div class="actions" style="margin-top:10px;">
        <button id="googleSignIn" class="secondary">Sign in with Google</button>
      </div>

      <p id="authStatus" style="margin-top:10px;color:#333;font-size:14px;text-align:center;"></p>
    </div>
  </main>

  <footer class="container muted small" style="text-align:center;margin-top:20px;">
    Privacy â€¢ Terms â€¢ Â© 2025 PetRewardHub
  </footer>

  <!-- âœ… Inline redirect + handler (final failsafe) -->
  <script>
    // Firebase config
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyDQFmVlYyJGc0GaY5F6p2fWKqrrYkrQzAo",
      authDomain: "petrewardhub.firebaseapp.com",
      projectId: "petrewardhub",
      storageBucket: "petrewardhub.firebasestorage.app",
      messagingSenderId: "1087250543825",
      appId: "1:1087250543825:web:4d92bc084978fab9a0c1f0"
    };
    firebase.initializeApp(FIREBASE_CONFIG);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const emailEl = document.getElementById("email");
    const passEl = document.getElementById("password");
    const statusEl = document.getElementById("authStatus");

    function showStatus(msg, color="black") {
      statusEl.style.color = color;
      statusEl.textContent = msg;
    }

    // --- SIGNUP ---
    document.getElementById("signupBtn").addEventListener("click", async () => {
      const e = emailEl.value.trim();
      const p = passEl.value.trim();
      if (!e || !p) return showStatus("Please enter email & password", "red");
      showStatus("Creating account...");
      try {
        const res = await auth.createUserWithEmailAndPassword(e, p);
        await db.collection("users").doc(res.user.uid).set({
          email: e,
          coins: 0,
          createdAt: new Date()
        });
        showStatus("Signup successful! Redirecting...", "green");
        setTimeout(() => (window.location.href = "select-pet.html"), 1000);
      } catch (err) {
        showStatus(err.message, "red");
      }
    });

    // --- LOGIN ---
    document.getElementById("loginBtn").addEventListener("click", async () => {
      const e = emailEl.value.trim();
      const p = passEl.value.trim();
      if (!e || !p) return showStatus("Please enter email & password", "red");
      showStatus("Signing in...");
      try {
        await auth.signInWithEmailAndPassword(e, p);
        showStatus("Login successful! Redirecting...", "green");
        setTimeout(() => (window.location.href = "select-pet.html"), 1000);
      } catch (err) {
        showStatus(err.message, "red");
      }
    });

    // --- GOOGLE LOGIN ---
    document.getElementById("googleSignIn").addEventListener("click", async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        await auth.signInWithPopup(provider);
        showStatus("Google login successful! Redirecting...", "green");
        setTimeout(() => (window.location.href = "select-pet.html"), 1000);
      } catch (err) {
        showStatus(err.message, "red");
      }
    });

    // --- AUTO REDIRECT IF ALREADY LOGGED IN ---
    auth.onAuthStateChanged((user) => {
      if (user) {
        console.log("User already logged in:", user.email);
        setTimeout(() => (window.location.href = "select-pet.html"), 1000);
      }
    });
  </script>
</body>
</html>
